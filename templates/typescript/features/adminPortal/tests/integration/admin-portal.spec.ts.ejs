import request from 'supertest';
import { buildTestApp } from '../../utils/test-app';

describe('Admin portal', () => {
  it('returns dashboard data for admin users', async () => {
    const app = await buildTestApp();

    const loginResponse = await request(app).post('/auth/login').send({
      email: 'admin@example.com',
      password: 'Admin#1234',
    });

    const { accessToken } = loginResponse.body.tokens;

    const response = await request(app)
      .get('/admin/dashboard')
      .set('Authorization', `Bearer ${accessToken}`);

    expect(response.status).toBe(200);
    expect(response.body).toHaveProperty('metrics');
  });
});
